<div class="row-fluid">
    <fieldset>
	<div class="span12">
        <form  parsley-validate id="form_input_{$acak}" method="post" class="form-horizontal" url="{$host}backoffice-simpan/tbl_buku/{$sts|default:'add'}">
			<input type="hidden" name="id" id="id_{$acak}" value="{$data.id|default:''}">
			<table class="table table-hover">
			{include file="backend/template/input_goyz.html" label="Tingkatan" type="select" name="tingkatan" id_na="tingkatan" data_combo=$tingkat class="validasi" id_combo=$data.id_tingkatan|default:'' style_type="width:80%" }
			{include file="backend/template/input_goyz.html" label="Kelas" type="select" name="cl_kelas_id" id_na="cl_kelas_id" class="validasi" style_type="width:80%"}
			{include file="backend/template/input_goyz.html" label="Group Sekolah" type="select" name="cl_group_sekolah" id_na="cl_group_sekolah" data_combo=$group class="validasi" id_combo=$data.cl_group_sekolah|default:'' style_type="width:80%"}
			{include file="backend/template/input_goyz.html" label="Kategori" type="select" name="cl_kategori_id" id_na="cl_kategori_id" data_combo=$kat class="validasi" id_combo=$data.cl_kategori_id|default:'' style_type="width:80%"}
			{include file="backend/template/input_goyz.html" label="Edisi" type="select" name="cl_edisi_id" id_na="cl_edisi_id" data_combo=$edisi class="validasi" id_combo=$data.cl_edisi_id|default:'' style_type="width:80%"}
			{include file="backend/template/input_goyz.html" label="Kode Buku" type="text" name="kode_buku" id_na="kode_buku"  style_type="width:30%" class="validasi" value=$data.kode_buku|default:''}
			{include file="backend/template/input_goyz.html" label="ISBN" type="text" name="isbn" id_na="isbn" class="validasi"  style_type="width:30%" value=$data.isbn|default:''}
			{include file="backend/template/input_goyz.html" label="Judul Buku" type="text" name="judul_buku" id_na="judul_buku"  style_type="width:80%" class="validasi" value=$data.judul_buku|default:''}
			{include file="backend/template/input_goyz.html" label="Desc. Buku" type="editor" name="deskripsi_buku" id_na="deskripsi_buku" value=$data.deskripsi_buku|default:''}
			{include file="backend/template/input_goyz.html" label="Penerbit" type="text" name="penerbit" id_na="penerbit"  style_type="width:80%" class="validasi" value=$data.penerbit|default:''}
			{include file="backend/template/input_goyz.html" label="Jml. Halaman" type="text" name="jml_hal" id_na="jml_hal"  style_type="width:100px;height:30px;"  class='angka validasi' style="height:34px;font-size: 13px;padding: 8px 12px;text-align:right" value=$data.jml_hal|default:''}
			{include file="backend/template/input_goyz.html" label="Ukuran Buku" type="text" name="ukuran_buku" id_na="ukuran_buku" style_type="width:100px;" class="validasi" value=$data.ukuran_buku|default:''}
			{include file="backend/template/input_goyz.html" label="Harga Zona 1" type="text" name="harga_zona_1" id_na="harga_zona_1"  class='angka validasi' style_type="width:50%;height:30px;" value=$data.harga_zona_1|default:''}
			{include file="backend/template/input_goyz.html" label="Harga Zona 2" type="text" name="harga_zona_2" id_na="harga_zona_2" class='angka validasi' style_type="width:50%;height:30px;" value=$data.harga_zona_2|default:''}
			{include file="backend/template/input_goyz.html" label="Harga Zona 3" type="text" name="harga_zona_3" id_na="harga_zona_3" class='angka validasi' style_type="width:50%;height:30px;" value=$data.harga_zona_3|default:''}
			{include file="backend/template/input_goyz.html" label="Harga Zona 4" type="text" name="harga_zona_4" id_na="harga_zona_4" class='angka validasi' style_type="width:50%;height:30px;" value=$data.harga_zona_4|default:''}
			{include file="backend/template/input_goyz.html" label="Harga Zona 5" type="text" name="harga_zona_5" id_na="harga_zona_5" class='angka validasi' style_type="width:50%;height:30px;" value=$data.harga_zona_5|default:''}
			{include file="backend/template/input_goyz.html" label="Harga Pemerintah Zona 1" type="text" name="harga_pemerintah_zona_1" id_na="harga_pemerintah_zona_1" class='angka validasi' style_type="width:50%;height:30px;" value=$data.harga_pemerintah_zona_1|default:''}
			{include file="backend/template/input_goyz.html" label="Harga Pemerintah Zona 2" type="text" name="harga_pemerintah_zona_2" id_na="harga_pemerintah_zona_2" class='angka validasi' style_type="width:50%;height:30px;" value=$data.harga_pemerintah_zona_2|default:''}
			{include file="backend/template/input_goyz.html" label="Harga Pemerintah Zona 3" type="text" name="harga_pemerintah_zona_3" id_na="harga_pemerintah_zona_3" class='angka validasi' style_type="width:50%;height:30px;" value=$data.harga_pemerintah_zona_3|default:''}
			{include file="backend/template/input_goyz.html" label="Harga Pemerintah Zona 4" type="text" name="harga_pemerintah_zona_4" id_na="harga_pemerintah_zona_4" class='angka validasi' style_type="width:50%;height:30px;" value=$data.harga_pemerintah_zona_4|default:''}
			{include file="backend/template/input_goyz.html" label="Harga Pemerintah Zona 5" type="text" name="harga_pemerintah_zona_5" id_na="harga_pemerintah_zona_5" class='angka validasi' style_type="width:50%;height:30px;" value=$data.harga_pemerintah_zona_5|default:''}
			{include file="backend/template/upload.html" label="Upload Gambar" name="foto_buku" id_na="foto_buku" mod="buku" id_batal="batal_buku_{$acak}" msg="Data Input Buku Sudah Tersimpan"}
			
			{if $sts eq 'edit'}
			<tr>
			<td>&nbsp;</td><td style="width:20%">File Exist:</td><td>:</td>
			<td style="font-weight:bold;">
			<div class="row-fluid">
				{foreach from=$foto item=i}
				  <div class="span2 gbr_{$i.id}" id="list_{$acak}_{$i.id}">
					<div class="thumbnail">
					  <img src="{$host}__repository/produk/{$i.foto_buku|default:''}" alt="...">
					  <div class="caption">
						<center>{include file="backend/template/button_save.html" click="hapus_file('foto_buku',{$i.id},'list_{$acak}_{$i.id}')" text="Hapus" id_na="hapus_gambar" style_btn="btn-danger"  btn_goyz="true"}</center>
					  </div>
					</div>
				  </div>
				  
				{/foreach}
			</div>
			</td>
			</tr>
			{/if}
			</table>
			<div class="col-sm-7 col-sm-offset-3">
				<div class="pull-right">
					{include file="backend/template/button_save.html" text="Simpan Data" id_na="simpan_buku" style_btn="btn-success"  btn_goyz="true"}
					{include file="backend/template/button_save.html" text="Kembali" id_na="batal_buku" style_btn="btn-info"  btn_goyz="true"}
				</div>
			</div>
		</form>
	</div>
	</fieldset>
</div>
<script>
	var upl_vid=0;
	$(".validasi").validatebox({ required:true }); 
	$('.angka').numberbox({
		min:0,
		precision:2,
		groupSeparator:','
	});

	$('#tingkatan{$acak}').change(function(){
		$('#cl_kelas_id{$acak}').empty();
		fillCombo(host+'backoffice-combo','cl_kelas_id{$acak}','cl_kelas',$(this).val(),'{$data.cl_kelas_id|default:''}');
	});
	
	$('#batal_buku_{$acak}').bind('click',function(){
		$('#grid_nya_{$mod}').show();
		$('#detil_nya_{$mod}').hide();
	});
	$('#simpan_buku_{$acak}').bind('click',function(){
		
		if ($('#form_input_{$acak}').form('validate')){
			submit_form('form_input_{$acak}',function(r){
				console.log(r)
				var js=JSON.parse(r);
				if(js.msg==1){
					if(uploadObj_foto_buku_{$acak}.getFileCount() > 0){
						uploadObj_foto_buku_{$acak}.update({ dynamicFormData:function()
						{
							var data ={ tbl_buku_id:js.data,
										mod:'tbl_foto_buku',
										tingkat:$("#tingkatan{$acak} option:selected").text(), 
										kelas:$("#cl_kelas_id{$acak} option:selected").text(), 
										group:$("#cl_group_sekolah{$acak} option:selected").text(), 
										kat:$("#cl_kategori_id{$acak} option:selected").text()
									  }
							return data;
						} 
						});
						uploadObj_foto_buku_{$acak}.startUpload();
					}else{
						$.messager.alert('MKS Store Back-Office','Data Input Buku Sudah Tersimpan','info');
						$('#batal_buku_{$acak}').trigger('click');
						grid_nya.datagrid('reload');
					}
				}else{
					//console.log(r);
					$.messager.alert('MKS Store Back-Office',"Tdak Dapat Menyimpan Data",'error');
				}
			});
		}else{
			$.messager.alert('MKS Store Back-Office',"Isi Data Yang Kosong ",'info');
		} 
	
		/* simpan_form('form_input_{$acak}','batal_buku_{$acak}','Data Input Buku Sudah Tersimpan'); */
	});
	{if $sts eq 'edit'}
		$('#tingkatan{$acak}').trigger('change');
	{/if}
</script>